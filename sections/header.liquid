{% assign instagram = section.settings.instagram %}
{% if instagram != blank %}
  {% assign entrada_instagram = instagram | strip %}
  {% if entrada_instagram contains 'instagram.com' or entrada_instagram contains '://' %}
    {% assign url_instagram = entrada_instagram %}
    {% unless url_instagram contains '://' %}
      {% assign url_instagram = 'https://' | append: url_instagram %}
    {% endunless %}
  {% else %}
    {% assign usuario_instagram = entrada_instagram %}
    {% assign primer_caracter = usuario_instagram | slice: 0, 1 %}
    {% if primer_caracter == '@' %}
      {% assign usuario_instagram = usuario_instagram | remove: '@' %}
    {% endif %}
    {% assign url_instagram = 'https://instagram.com/' | append: usuario_instagram %}
  {% endif %}
{% endif %}

<header id='encabezado'>
  <!-- Botón hamburguesa visible en móvil -->
  <div id='botonHamburguesa' class='botonHamburguesa' aria-expanded='false' aria-label='Abrir menú'>
    <span class='barraHamburguesa'></span>
    <span class='barraHamburguesa'></span>
    <span class='barraHamburguesa'></span>
  </div>

  <h2 class='encabezadoTitulo'>
    {{ shop.name | link_to: routes.root_url }}
  </h2>

  <div class='encabezadoMenu'>
    {% for link in linklists['main-menu'].links %}
      <a href='{{ link.url }}'>{{ link.title }}</a>
    {% endfor %}
    <!-- Iconos se mostrarán aquí en móvil -->
    <div class='encabezadoIconos encabezadoIconos--menu'>
      {% if instagram != blank %}
        <div class='encabezadoSocial'>
          <a href='{{ url_instagram }}' target='_blank' rel='noopener noreferrer'>
            <img src='{{ 'icono-instagram.svg' | asset_url }}' alt='Instagram' width='30px' height='30px'>
          </a>
        </div>
      {% endif %}

      {% if shop.customer_accounts_enabled %}
        {{ 'icon-account.svg' | inline_asset_content | link_to: routes.account_url }}
      {% endif %}

      <a href='{{ routes.cart_url }}'>
        {% if cart.item_count > 0 %}
          <sup class='contadorCarrito' data-contador-carrito>{{ cart.item_count }}</sup>
        {% endif %}
        {{ 'icon-cart.svg' | inline_asset_content }}
      </a>
    </div>
  </div>
  <!-- Iconos duplicados removidos en desktop via CSS -->
  <div class='encabezadoIconos'>
    {% if instagram != blank %}
      <div class='encabezadoSocial'>
        <a href='{{ url_instagram }}' target='_blank' rel='noopener noreferrer'>
          <img src='{{ 'icono-instagram.svg' | asset_url }}' alt='Instagram' width='30px' height='30px'>
        </a>
      </div>
    {% endif %}

    {% if shop.customer_accounts_enabled %}
      {{ 'icon-account.svg' | inline_asset_content | link_to: routes.account_url }}
    {% endif %}

    <a href='{{ routes.cart_url }}'>
      {% if cart.item_count > 0 %}
        <sup class='contadorCarrito' data-contador-carrito>{{ cart.item_count }}</sup>
      {% endif %}
      {{ 'icon-cart.svg' | inline_asset_content }}
    </a>
  </div>
</header>

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:labels.menu"
    },
    {
      "type": "text",
      "id": "instagram",
      "label": "Instagram (usuario o URL)",
      "info": "Introduce tu nombre de usuario o pega la URL completa."
    }
  ]
}
{% endschema %}

{% stylesheet %}
  header {
    height: 5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: fixed;
    z-index: 999;
    width: 100vw;
    left: 0;
    padding: 0 100px;
    transition:
      background-color 220ms ease,
      box-shadow 220ms ease,
      backdrop-filter 220ms ease;
  }

  header a {
    position: relative;
    text-decoration: none;
    color: var(--color-foreground);
  }

  header a sup {
    position: absolute;
    left: 100%;
    overflow: hidden;
    max-width: 90vw;
  }

  header svg {
    width: 2rem;
  }

  header .encabezadoMenu {
    display: flex;
    gap: 1rem;
  }
  /* Solo el contenedor de iconos de primer nivel en escritorio */
  header > .encabezadoIconos {
    display: flex;
    gap: 1rem;
  }
  /* Ocultar grupo de iconos anidado dentro del menú por defecto (escritorio) */
  header .encabezadoMenu .encabezadoIconos {
    display: none;
  }

  .encabezadoTitulo {
    text-align: left;
    font-weight: bold;
  }

  .botonHamburguesa {
    display: none;
    background: transparent;
    border: 0;
    padding: 0.5rem;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    flex-direction: column;
  }

  .barraHamburguesa {
    display: block;
    width: 22px;
    height: 2px;
    background: #130808;
    margin: 4px 0;
  }

  header.conFondo {
    background-color: rgba(255, 255, 255, 0.85);
    backdrop-filter: saturate(150%) blur(8px);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
  }

  @media (max-width: 768px) {
    header {
      padding: 0 1rem;
    }

    header .encabezadoTitulo {
      order: 1;
      flex: 1 1 auto;
    }
    header .botonHamburguesa {
      order: 2;
      margin-left: auto;
    }

    header .encabezadoMenu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      flex-direction: column;
      padding: 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      z-index: 998;
      gap: 0;
    }

    header .encabezadoMenu a {
      padding: 1rem;
      display: block;
      border-bottom: 1px solid rgba(0, 0, 0, 0.04);
      text-align: center;
    }

    header .botonHamburguesa {
      display: flex;
    }

    header.abierto .encabezadoMenu {
      display: flex;
    }

    header > .encabezadoIconos {
      display: none;
    }

    header .encabezadoMenu .encabezadoIconos {
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      padding: 0.75rem 1rem;
      border-top: 1px solid rgba(0, 0, 0, 0.06);
    }
  }
{% endstylesheet %}
