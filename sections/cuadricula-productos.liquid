<section
  class='seccionCuadriculaProductos'
  style='--cols: {{ section.settings.columnas_desktop | default: 3 }}; --cols-m: {{ section.settings.columnas_movil | default: 1 }}; --gap: {{ section.settings.espaciado | default: 16 }}px;'
  id='cuadricula-{{ section.id }}'
  data-collection='{{ section.settings.coleccion.handle }}'
>
  {% if section.settings.coleccion != blank %}
    {% comment %} Contenedor de filtros nativos (se cargará dinámicamente) {% endcomment %}
    <div id='filtros-{{ section.id }}' class='filtrosNativos'></div>

    {% comment %} Grid de productos {% endcomment %}
    <div class='cuadriculaProductos' id='grid-{{ section.id }}'></div>

    <div id='sentinel-{{ section.id }}' aria-hidden='true'></div>
  {% else %}
    <div class='cuadriculaProductos'>
      <p class='mensajeVacio'>Selecciona una colección para mostrar productos.</p>
    </div>
  {% endif %}
</section>

{% schema %}
{
  "name": "Cuadrícula de Productos",
  "tag": "section",
  "class": "cuadricula-productos-section",
  "settings": [
    {
      "type": "collection",
      "id": "coleccion",
      "label": "Colección"
    }
  ],
  "presets": [
    {
      "name": "Cuadrícula de Productos"
    }
  ]
}
{% endschema %}

<script src='{{ 'filtros-nativos.js' | asset_url }}' defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var handle = '{{ section.settings.coleccion.handle }}';
    if (!handle) {
      console.warn('No hay colección seleccionada en cuadricula-productos');
      return;
    }

    if (!window.FiltrosNativos) {
      console.error('FiltrosNativos no está disponible');
      return;
    }

    window.FiltrosNativos.init({
      rootId: 'cuadricula-{{ section.id }}',
      filtrosContainer: document.querySelector('#filtros-{{ section.id }}'),
      productosContainer: document.querySelector('#grid-{{ section.id }}'),
      sentinel: document.querySelector('#sentinel-{{ section.id }}'),
      collectionUrl: '/collections/' + handle,
      sectionId: 'collection',
      productosSelector: '.collection-products',
      fetchOnInit: true,
    });
  });
</script>

<style>
  .seccionCuadriculaProductos {
    width: 100%;
  }

  .filtrosNativos {
    margin-bottom: 1.5rem;
  }

  .filtrosNativos .coleccionContenedor {
    display: block;
  }

  .filtrosNativos .contenedorFiltros {
    position: static;
    margin-bottom: 1rem;
  }

  .filtrosNativos .collection-products {
    display: none;
  }

  .cuadriculaProductos {
    display: grid;
    grid-template-columns: repeat(var(--cols, 3), minmax(0, 1fr));
    gap: var(--gap, 16px);
    transition:
      opacity 0.2s ease,
      transform 0.2s ease;
  }

  @media (max-width: 768px) {
    .cuadriculaProductos {
      grid-template-columns: repeat(var(--cols-m, 1), minmax(0, 1fr));
    }
  }

  .mensajeVacio {
    opacity: 0.8;
  }
</style>
